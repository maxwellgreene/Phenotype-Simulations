---
title: "Sociality Simulation Outline & To-Do"
output: pdf_document#html_notebook
---
```{r}
library(tidyverse)
```

#Colony parameters:

1. Birth Ratio -> tendency to create reproductive or workers
    + Seasonal
    + Population, number of reproductives and workers
    + 
  
2. When Queen stops foraging
    + Number of workers

3. 

###Evolving paremeters
1. Worker body size (energy required to create)

#Environmental parameters:
1. Forager mortality rate
  
2. Forager success (resource availability)

###Seasonal changes


#Interesting questions:

#Future additions:
1. Add brood care or growth time



```{r}
#Whether to birth a reproductive or a worker
#TRUE for reproductive, FALSE for worker
birthReprod <- function(nReprod,nWorker,Day,nDayCycle)
{
  temp <- 1-(Day/nDayCycle);
  temp2 <- runif(1,0,1) > .5
  return(temp>temp2);
}

#Set foraging mortality rate given day in cycle
fMortRate <- function(Day,nDayCycle)
{
  temp <- .65+(Day/nDayCycle-.5)^2;
  return(temp);
}

#Set parameters for when reproductives stop foraging
isReprodForage <- function(nWorker)
{
  return(ifelse(nWorker<2,TRUE,FALSE))
}
```

```{r}
#Set number of Days in a Cycle
Day <- 0; nDayCycle <- 20;
#Starting number of reproductives, workers and energy stores
nReprod <- 1; nWorker <- 0; kStore <- 0;
#Number of trips that workers and reproductives can make each day
nTripReprod <- 2; nTripWorker <- 2.5;
#Set amount of energy per trip that workers and reproductives make
kTripWorker <- 2; kTripReprod <- 2;
#Set amount of energy needed to create a worker and reproductive
kCreateWorker <- 3; kCreateReprod <- 3.5;

#Create dataframe to store data.
data <- data.frame(timestep=0,nReprod=nReprod,nWorker=nWorker,kStore=kStore)

for (i in 1:nDayCycle)
{
  #Forage as much as you can/need with workers
  #!!!!! When does Queen/reproductives stop foraging?
  #!!!!! How to incorporate mortality rate?
  
  nWorker <- (nWorker*fMortRate(Day,nDayCycle));
  kStore <- kStore + nWorker * nTripWorker;
  
  if(isReprodForage(nWorker=nWorker))
  {
    nReprod <- (nReprod*fMortRate(Day,nDayCycle));
    kStore <- kStore + nReprod * nTripReprod;
  }
  
  while (kStore > 0)
  {
    if(kStore > kCreateReprod)
    {
      if(birthReprod(nReprod,nWorker,Day,nDayCycle))
        {kStore <- kStore - kCreateReprod;  nReprod <- nReprod+1;}
        else    
        {kStore <- kStore - kCreateWorker;  nWorker <- nWorker+1;}
    }
    else{
      if(kStore > kCreateWorker)
      {kStore <- kStore - kCreateWorker;  nWorker <- nWorker + 1;}
      else{break}
    }
  }
  
  if(i%%5==0){print(paste("Day: ",i,"  kStore: ",kStore,"  nReprod: ",nReprod,"  nWorker: ",nWorker));}
  data <- rbind(data,list(i,nReprod,nWorker,kStore))
}

ggplot(data,aes(x=timestep)) + geom_line(aes(y=kStore,color="kStore")) + geom_line(aes(y=nReprod,color="nReprod")) + geom_line(aes(y=nWorker,color="nWorker")) + scale_colour_manual("",breaks = c("kStore", "nReprod", "nWorker"),values = c("kStore"="green","nReprod"="red","nWorker"="blue"))
```